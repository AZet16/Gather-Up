
const express = require("express");
const User = require("../models/user_model");
const jwt = require('jsonwebtoken');



//pass new user info for registration form
const registerUser= async (req, res) => {
    console.log(req.body);
    try {
        const user = await User.create({
            name: req.body.name,
            email: req.body.email,
            password: req.body.password
        });

        //res.set('Content-type', 'application/json');
        res.json({user: email, mss: 'created user'});  //send smth can cause error if data cannot be properly send in JSON, use {} to send as JSON, otherwise it may look as HTML
        res.json({ status: `ok`, mssg: `information reached the server` });

    } catch (error) {
        res.json({ status: `error`, mssg: `email already exists in the database`});
    }
    
};

//pass new user info for login
const loginUser = async (req, res) => {
    const user = await User.findOne({email: req.body.email, password: req.body.password});
   
    if (user) {
        
        const token = jwt.sign(
            {
                name: user.name,
                email: user.email,

            },
            'secret123keytoencodejsonpayload'
        );
        res.json({ status: `ok`, mssg: `authentication passed`, user:token});
    } else {
        res.json({ status: `error`, mssg: `failed authentication`, user: false });
    }
    
};

module.exports = { registerUser, loginUser };